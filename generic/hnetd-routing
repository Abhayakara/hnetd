#!/bin/sh

[ -z "$2" ] && echo "Error: should be run by hnetd" && exit 1

action="$1"
proto="$2"

BABEL_EXE=/usr/sbin/babeld
BABEL_ARGS="-C redistribute ip 0.0.0.0/0 eq 0 proto 3 metric 128 "\
"-C redistribute ip 0.0.0.0/0 eq 0 metric 128 "\
"-C redistribute ip ::/0 eq 0 metric 128 "\
"-C redistribute eq 64 "

case "$action" in
	enumerate)
		## echo PROTOCOL-ID PREFERENCE
		## example for babel:
		[ -x "$BABEL_EXE" ] && echo 1 128
	;;
	enable|reconfigure|disable)
		case "$proto" in
			1)
	                        while start-stop-daemon -K -q -t -x $BABEL_EXE
                                do
				    start-stop-daemon -K -x $BABEL_EXE
                                    sleep 1
                                done
				
				shift 2
				if [ "$action" != "disable" -a -n "$1" ]; then
					start-stop-daemon -S -x $BABEL_EXE -- -D `echo $BABEL_ARGS` $*
				fi 
			;;
			*)
				exit 1;
			;;
		esac
		exit 0;
	;;
esac
